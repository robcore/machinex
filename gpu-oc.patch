From c4dc934fa8c286e9b2c57a732a466a0a7a4f1d94 Mon Sep 17 00:00:00 2001
From: flar2 <asegaert@gmail.com>
Date: Sat, 17 Aug 2013 01:31:49 -0400
Subject: [PATCH] GPU overclock

Signed-off-by: flar2 <asegaert@gmail.com>
---
 arch/arm/mach-msm/board-m7-gpu.c | 34 ++++++++++++++++++++++++++++++----
 arch/arm/mach-msm/clock-8960.c   |  5 +++--
 2 files changed, 33 insertions(+), 6 deletions(-)

diff --git a/arch/arm/mach-msm/board-m7-gpu.c b/arch/arm/mach-msm/board-m7-gpu.c
index 53d7cec..77aa2c7 100644
--- a/arch/arm/mach-msm/board-m7-gpu.c
+++ b/arch/arm/mach-msm/board-m7-gpu.c
@@ -22,6 +22,8 @@
 #include "devices.h"
 #include "board-m7.h"
 
+uint32_t max_gpu = 2;
+
 #ifdef CONFIG_MSM_DCVS
 static struct msm_dcvs_freq_entry grp3d_freq[] = {
        {0, 0, 333932},
@@ -68,13 +70,13 @@ static struct msm_bus_vectors grp3d_low_vectors[] = {
 		.src = MSM_BUS_MASTER_GRAPHICS_3D,
 		.dst = MSM_BUS_SLAVE_EBI_CH0,
 		.ab = 0,
-		.ib = KGSL_CONVERT_TO_MBPS(1000),
+		.ib = KGSL_CONVERT_TO_MBPS(1200),
 	},
 	{
 		.src = MSM_BUS_MASTER_GRAPHICS_3D_PORT1,
 		.dst = MSM_BUS_SLAVE_EBI_CH0,
 		.ab = 0,
-		.ib = KGSL_CONVERT_TO_MBPS(1000),
+		.ib = KGSL_CONVERT_TO_MBPS(1200),
 	},
 };
 
@@ -113,13 +115,13 @@ static struct msm_bus_vectors grp3d_max_vectors[] = {
 		.src = MSM_BUS_MASTER_GRAPHICS_3D,
 		.dst = MSM_BUS_SLAVE_EBI_CH0,
 		.ab = 0,
-		.ib = KGSL_CONVERT_TO_MBPS(4264),
+		.ib = KGSL_CONVERT_TO_MBPS(4800),
 	},
 	{
 		.src = MSM_BUS_MASTER_GRAPHICS_3D_PORT1,
 		.dst = MSM_BUS_SLAVE_EBI_CH0,
 		.ab = 0,
-		.ib = KGSL_CONVERT_TO_MBPS(4264),
+		.ib = KGSL_CONVERT_TO_MBPS(4800),
 	},
 };
 
@@ -242,9 +244,33 @@ struct platform_device device_kgsl_3d0 = {
 	},
 };
 
+/*gpuoc*/
+
+static int __init read_max_gpu(char *gpu_oc)
+{
+	if (strcmp(gpu_oc, "1") == 0) {
+		max_gpu = 1;
+	} else if (strcmp(gpu_oc, "2") == 0) {
+		max_gpu = 2;
+	} else if (strcmp(gpu_oc, "3") == 0) {
+		max_gpu = 3;
+	} else {
+		max_gpu = 0;
+	}	
+	return 0;
+}
+
+__setup("gpu_oc=", read_max_gpu);
+/*end gpuoc*/
+
 void __init m7_init_gpu(void)
 {
 	unsigned int version = socinfo_get_version();
+	if (max_gpu == 1)
+		kgsl_3d0_pdata.pwrlevel[0].gpu_freq = 450000000;
+
+	if (max_gpu == 2)
+		kgsl_3d0_pdata.pwrlevel[0].gpu_freq = 533333000;
 
 	if (cpu_is_apq8064ab())
 		kgsl_3d0_pdata.pwrlevel[0].gpu_freq = 450000000;
diff --git a/arch/arm/mach-msm/clock-8960.c b/arch/arm/mach-msm/clock-8960.c
index b3cc103..4e7eef6 100755
--- a/arch/arm/mach-msm/clock-8960.c
+++ b/arch/arm/mach-msm/clock-8960.c
@@ -3449,7 +3449,8 @@ static struct clk_freq_tbl clk_tbl_gfx3d[] = {
 	F_GFX3D(266667000, pll2,  1,  3),
 	F_GFX3D(320000000, pll2,  2,  5),
 	F_GFX3D(400000000, pll2,  1,  2),
-	F_GFX3D(450000000, pll15, 1,  2),
+	F_GFX3D(487500000, pll15, 1,  2),
+	F_GFX3D(533333000, pll2, 2,  3),
 	F_END
 };
 
@@ -3483,7 +3484,7 @@ static unsigned long fmax_gfx3d_8064ab[MAX_VDD_LEVELS] __initdata = {
 static unsigned long fmax_gfx3d_8064[MAX_VDD_LEVELS] __initdata = {
 	[VDD_DIG_LOW]     = 128000000,
 	[VDD_DIG_NOMINAL] = 325000000,
-	[VDD_DIG_HIGH]    = 400000000
+	[VDD_DIG_HIGH]    = 533333000
 };
 
 static unsigned long fmax_gfx3d_8930[MAX_VDD_LEVELS] __initdata = {
